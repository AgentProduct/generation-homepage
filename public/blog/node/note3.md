## HTTP 协议

了解过协议栈的朋友应该都知道，协议栈分OSI 七层模型和TCP/IP 四层模型或五层模型。但不管是哪一种模型，都包含应用层，HTTP 就属于应用层协议的一种。

它主要用来在客户端和服务器之间传输数据。每个请求都是独立的，协议本身不会记住之前的请求和响应信息，所以它是一种无状态的协议。

**特点：**

- 基于请求-响应模型：HTTP 协议基于请求-响应模型，客户端发送请求，服务器返回响应。一次请求对应一次响应。
- 无状态：每个请求都是独立的，协议本身不会记住之前的请求和响应信息。（会话状态需要通过其他机制如 Cookie、Session 来管理）
- 明文传输：HTTP 协议在传输数据时是明文的，不加密。（现在 HTTP/2、HTTP/3 协议默认使用二进制格式传输数据，而 HTTPS 协议在 HTTP 协议基础上添加了 SSL/TLS 加密层，确保数据在传输过程中的安全性）
- 使用URI作为资源定位符：客户端通过 URL 来定位和访问服务器上的资源。URL 包含了协议、主机名、端口号、路径和查询参数等信息。每个资源（网页、图片、API 数据）都有一个唯一的地址，即统一资源标识符。

HTTP 请求和响应的关键组成部分：

请求报文:

1. 请求行：包含 方法、URL 和 HTTP 版本。
   - 方法（动词）：定义了操作类型。
     - `GET`：获取资源
     - `POST`：创建资源或提交数据。
     - `PUT`：更新/替换整个资源。
     - `PATCH`：对资源进行部分更新。
     - `DELETE`：删除资源
     - `HEAD`：获取资源的元数据
     - `OPTIONS`：获取资源的通信选项
     - `TRACE`：回显请求，用于测试或诊断
     - `CONNECT`：建立隧道连接，通常用于 HTTPS 代理
2. 请求头：包含元数据，如 `Host`、`User-Agent`、`Content-Type`、`Accept`、`Cookie`（指明请求体的格式，如 `application/json`）、`Authorization`（身份验证）。
3. 请求体：可选，包含要发送给服务器的数据（如 POST 提交的表单或 JSON 数据）。

响应报文：

1. 状态行：包含 HTTP 版本、状态码 和 状态信息。
   - 状态码：三位数字，用于表示请求的处理结果。**（底部附上了详细的状态码列表）**
     - 1xx：信息性状态码，表示请求已被接受，继续处理。
     - 2xx：成功状态码，表示请求已被成功处理。
     - 3xx：重定向状态码，表示需要进一步的操作才能完成请求。
     - 4xx：客户端错误状态码，表示请求包含错误的语法或无法完成请求。
     - 5xx：服务器错误状态码，表示服务器处理请求时发生错误。
2. 响应头：包含响应的元数据，如 `Content-Type`（响应体的格式）、`Content-Length`、`Set-Cookie` 等。
3. 响应体：包含服务器返回的数据，如 HTML 页面、JSON 数据或图片等。

## REST

**REST 架构风格是一种基于 HTTP 协议的软件架构风格，它不是标准或协议，而是一套设计约束和原则。其核心思想是：用 Web 标准（主要是 HTTP）来构建可伸缩、松耦合的网络服务。**

REST 的核心原则包括：

- 资源导向：REST 架构风格的系统将系统中的所有资源都视为可寻址的实体，每个资源都有一个唯一的 URI（Uniform Resource Identifier）。客户端可以通过 URI 来定位和访问资源。
- 统一接口：这是 REST 最核心的特征。统一的接口设计，客户端和服务器之间的通信通过 HTTP 协议进行，使用标准的 HTTP 方法和状态码。
- 无状态：每个请求都是独立的，服务器不会记住之前的请求和响应信息。
- 可缓存：可以通过添加缓存头来提高性能。客户端可以缓存响应，避免重复请求相同的资源。
- 分层系统：可以构建在多个层级的系统上，每个层级都负责不同的功能。客户端和服务器之间的通信通过 HTTP 协议进行，不依赖于特定的实现细节。
- 按需代码（可选）：可以支持按需加载代码，客户端可以根据需要请求特定的代码。这可以减少初始加载时间和带宽消耗。

**一个符合 REST 架构风格的系统，被称为 RESTful 系统。现在通常所说的 RESTful API 就是基于 HTTP 和 REST 原则设计的 Web API。**

### RESTful API

RESTful API 的典型特征：

- 使用清晰的、名词性的 URI 来标识资源（如 /articles， /orders/456）。
- 使用 HTTP 方法（GET、POST、PUT、DELETE 等）来对资源进行操作。
- 对资源的操作是无状态的，每个请求都是独立的。
- 对资源的操作可以返回不同的状态码，用于表示操作的结果。
- 对资源的操作可以返回不同的媒体类型（如 JSON、XML 等），客户端可以根据需要选择接受的媒体类型。

## 状态码 🔥

[MDN 参考](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Status)

### 消息响应

| 状态码 | 标题                         | 含义                                                                                         | HTTP 版本 |
| ------ | ---------------------------- | -------------------------------------------------------------------------------------------- | --------- |
| 100    | Continue 继续请求            | 这个临时响应表明，迄今为止的所有内容都是可行的，客户端应该继续请求，如果已经完成，则忽略它。 | HTTP/1.1  |
| 101    | Switching Protocols 切换协议 | 该代码是响应客户端的 Upgrade 请求头发送的，指明服务器即将切换的协议。                        | HTTP/1.1  |

### 成功响应

| 状态码 | 标题              | 含义                                                                                                                                                                                                                | HTTP 版本 |
| ------ | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 200    | OK 请求成功       | 成功的含义取决于 HTTP 方法：<br /> GET: 资源已被提取并在消息正文中传输。<br /> HEAD: 实体标头位于消息正文中。<br /> PUT or POST: 描述动作结果的资源在消息体中传输。<br /> TRACE: 消息正文包含服务器收到的请求消息。 | HTTP/0.9  |
| 201    | Created 创建成功  | 该请求已成功，并因此创建了一个新的资源。这通常是在 POST 请求，或是某些 PUT 请求之后返回的响应。                                                                                                                     | HTTP/0.9  |
| 202    | Accepted 接受请求 | 请求已经接收到，但还未响应，没有结果。意味着不会有一个异步的响应去表明当前请求的结果，预期另外的进程和服务去处理请求，或者批处理。                                                                                  | HTTP/0.9  |
| 204    | No Content 无内容 | 对于该请求没有的内容可发送，但头部字段可能有用。用户代理可能会用此时请求头部信息来更新原来资源的头部缓存字段。                                                                                                      | HTTP/0.9  |

### 重定向

| 状态码 | 标题                        | 含义                                                                                                                               | HTTP 版本 |
| ------ | --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 301    | Moved Permanently 永久移动  | 请求资源的 URL 已永久更改。在响应中给出了新的 URL。                                                                                | HTTP/0.9  |
| 302    | Found 临时移动              | 此响应代码表示所请求资源的 URI 已 暂时 更改。未来可能会对 URI 进行进一步的改变。因此，客户机应该在将来的请求中使用这个相同的 URI。 | HTTP/0.9  |
| 304    | Not Modified 未修改         | 这是用于缓存的目的。它告诉客户端响应还没有被修改，因此客户端可以继续使用相同的缓存版本的响应。                                     | HTTP/0.9  |
| 307    | Temporary Redirect 临时移动 | 302 Found 的严格版本，不可改变请求方法                                                                                             | HTTP/1.1  |
| 308    | Permanent Redirect 永久移动 | 301 Moved Permanently 的严格版本，不可改变请求方法                                                                                 | HTTP/1.1  |

### 客户端错误

| 状态码 | 标题                                           | 含义                                                                                                                                                                                                                                                                    | HTTP 版本 |
| ------ | ---------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 400    | Bad Request 请求错误                           | 由于被认为是客户端错误（例如，错误的请求语法、无效的请求消息帧或欺骗性的请求路由），服务器无法或不会处理请求。                                                                                                                                                          | HTTP/0.9  |
| 401    | Unauthorized 未授权                            | 虽然 HTTP 标准指定了"unauthorized"，但从语义上来说，这个响应意味着"unauthenticated"。也就是说，客户端必须对自身进行身份验证才能获得请求的响应。                                                                                                                         | HTTP/0.9  |
| 403    | Forbidden 无权限                               | 客户端没有访问内容的权限；也就是说，它是未经授权的，因此服务器拒绝提供请求的资源。与 401 Unauthorized 不同，服务器知道客户端的身份。                                                                                                                                    | HTTP/0.9  |
| 404    | Not Found 未找到                               | 服务器找不到请求的资源。在浏览器中，这意味着无法识别 URL。在 API 中，这也可能意味着端点有效，但资源本身不存在。服务器也可以发送此响应，而不是 403 Forbidden，以向未经授权的客户端隐藏资源的存在。这个响应代码可能是最广为人知的，因为它经常出现在网络上。               | HTTP/0.9  |
| 405    | Method Not Allowed 请求方法不允许              | 服务器知道请求方法，但目标资源不支持该方法。例如，API 可能不允许调用DELETE来删除资源。                                                                                                                                                                                  | HTTP/1.1  |
| 407    | Proxy Authentication Required 要求代理身份验证 | 类似于 401 Unauthorized 但是认证需要由代理完成。                                                                                                                                                                                                                        | HTTP/1.1  |
| 408    | Request Timeout 请求超时                       | 此响应由一些服务器在空闲连接上发送，即使客户端之前没有任何请求。这意味着服务器想关闭这个未使用的连接。由于一些浏览器，如 Chrome、Firefox 27+ 或 IE9，使用 HTTP 预连接机制来加速冲浪，所以这种响应被使用得更多。还要注意的是，有些服务器只是关闭了连接而没有发送此消息。 | HTTP/1.1  |
| 409    | Conflict 资源冲突                              | 当请求与服务器的当前状态冲突时，将发送此响应。                                                                                                                                                                                                                          | HTTP/1.1  |
| 410    | Gone 资源已删除                                | 当请求的内容已从服务器中永久删除且没有转发地址时，将发送此响应。                                                                                                                                                                                                        | HTTP/1.1  |
| 411    | Length Required 请求长度必需                   | 服务端拒绝该请求因为 Content-Length 头部字段未定义但是服务端需要它。                                                                                                                                                                                                    | HTTP/1.1  |
| 412    | Precondition Failed 前提条件失败               | 客户端在其头文件中指出了服务器不满足的先决条件。                                                                                                                                                                                                                        | HTTP/1.1  |
| 413    | Request Entity Too Large 请求实体过大          | 请求实体大于服务器定义的限制。服务器可能会关闭连接，或在标头字段后返回重试 Retry-After。                                                                                                                                                                                | HTTP/1.1  |
| 414    | Request-URI Too Long 请求URI太长               | 客户端请求的 URI 比服务器愿意接收的长度长。                                                                                                                                                                                                                             | HTTP/1.1  |
| 415    | Unsupported Media Type 不支持的媒体类型        | 服务器不支持请求数据的媒体格式，因此服务器拒绝请求。                                                                                                                                                                                                                    | HTTP/1.1  |
| 416    | Requested Range Not Satisfiable 请求范围不满足 | 无法满足请求中 Range 标头字段指定的范围。该范围可能超出了目标 URI 数据的大小。                                                                                                                                                                                          | HTTP/1.1  |
| 417    | Expectation Failed 期望失败                    | 此响应代码表示服务器无法满足 Expect 请求标头字段所指示的期望。                                                                                                                                                                                                          | HTTP/1.1  |
| 421    | Misdirected Request 错误指向的请求             | 请求被定向到无法生成响应的服务器。                                                                                                                                                                                                                                      | HTTP/1.1  |
| 422    | Unprocessable Entity 无法处理的实体            | 请求格式正确，但由于语义错误而无法遵循。                                                                                                                                                                                                                                | HTTP/1.1  |
| 429    | Too Many Requests 太多请求                     | 用户在给定的时间内发送了太多请求                                                                                                                                                                                                                                        | HTTP/1.1  |

### 服务端错误

| 状态码 | 标题                                        | 含义                                                                                 | HTTP 版本 |
| ------ | ------------------------------------------- | ------------------------------------------------------------------------------------ | --------- |
| 500    | Internal Server Error 内部服务器错误        | 服务器遇到了不知道如何处理的情况。                                                   | HTTP/0.9  |
| 501    | Not Implemented 未实现                      | 服务器不支持请求方法，因此无法处理。                                                 | HTTP/0.9  |
| 502    | Bad Gateway 错误网关                        | 此错误响应表明服务器作为网关需要得到一个处理这个请求的响应，但是得到一个错误的响应。 | HTTP/0.9  |
| 503    | Service Unavailable 服务不可用              | 服务器没有准备好处理请求。常见原因是服务器因维护或重载而停机。                       | HTTP/0.9  |
| 504    | Gateway Timeout 网关超时                    | 当服务器充当网关且无法及时获得响应时，会给出此错误响应。                             | HTTP/1.1  |
| 505    | HTTP Version Not Supported 不支持的HTTP版本 | 服务器不支持请求中使用的 HTTP 版本。                                                 | HTTP/1.1  |
